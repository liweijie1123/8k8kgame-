JSNES.ROM=function(e){this.nes=e,this.mapperName=new Array(181);for(var r=0;r<181;r++)this.mapperName[r]="Unknown Mapper";this.mapperName[0]="Direct Access",this.mapperName[1]="Nintendo MMC1",this.mapperName[2]="UNROM",this.mapperName[3]="CNROM",this.mapperName[4]="Nintendo MMC3",this.mapperName[5]="Nintendo MMC5",this.mapperName[6]="FFE F4xxx",this.mapperName[7]="AOROM",this.mapperName[8]="FFE F3xxx",this.mapperName[9]="Nintendo MMC2",this.mapperName[10]="Nintendo MMC4",this.mapperName[11]="Color Dreams Chip",this.mapperName[12]="FFE F6xxx",this.mapperName[15]="100-in-1 switch",this.mapperName[16]="Bandai chip",this.mapperName[17]="FFE F8xxx",this.mapperName[18]="Jaleco SS8806 chip",this.mapperName[19]="Namcot 106 chip",this.mapperName[20]="Famicom Disk System",this.mapperName[21]="Konami VRC4a",this.mapperName[22]="Konami VRC2a",this.mapperName[23]="Konami VRC2a",this.mapperName[24]="Konami VRC6",this.mapperName[25]="Konami VRC4b",this.mapperName[32]="Irem G-101 chip",this.mapperName[33]="Taito TC0190/TC0350",this.mapperName[34]="32kB ROM switch",this.mapperName[38]=" Mapper 038",this.mapperName[64]="Tengen RAMBO-1 chip",this.mapperName[65]="Irem H-3001 chip",this.mapperName[66]="GNROM switch",this.mapperName[67]="SunSoft3 chip",this.mapperName[68]="SunSoft4 chip",this.mapperName[69]="SunSoft5 FME-7 chip",this.mapperName[71]="Camerica chip",this.mapperName[78]="Irem 74HC161/32-based",this.mapperName[91]="Pirate HK-SF3 chip",this.mapperName[94]="UN1ROM",this.mapperName[140]="Mapper 140",this.mapperName[180]="Mapper 180"},JSNES.ROM.prototype={VERTICAL_MIRRORING:0,HORIZONTAL_MIRRORING:1,FOURSCREEN_MIRRORING:2,SINGLESCREEN_MIRRORING:3,SINGLESCREEN_MIRRORING2:4,SINGLESCREEN_MIRRORING3:5,SINGLESCREEN_MIRRORING4:6,CHRROM_MIRRORING:7,header:null,rom:null,vrom:null,vromTile:null,romCount:null,vromCount:null,mirroring:null,batteryRam:null,trainer:null,fourScreen:null,mapperType:null,valid:!1,load:function(e){var r,a;if(-1===e.indexOf("NES"))this.nes.ui.updateStatus("Not a valid NES ROM.");else{for(this.header=new Array(16),t=0;t<16;t++)this.header[t]=255&e.charCodeAt(t);this.romCount=this.header[4],this.vromCount=2*this.header[5],this.mirroring=0!=(1&this.header[6])?1:0,this.batteryRam=0!=(2&this.header[6]),this.trainer=0!=(4&this.header[6]),this.fourScreen=0!=(8&this.header[6]),this.mapperType=this.header[6]>>4|240&this.header[7];for(var i=!1,t=8;t<16;t++)if(0!==this.header[t]){i=!0;break}i&&(this.mapperType&=15),this.rom=new Array(this.romCount);var p,m,h=16;for(t=0;t<this.romCount;t++){for(this.rom[t]=new Array(16384),r=0;r<16384&&!(h+r>=e.length);r++)this.rom[t][r]=255&e.charCodeAt(h+r);h+=16384}for(this.vrom=new Array(this.vromCount),t=0;t<this.vromCount;t++){for(this.vrom[t]=new Array(4096),r=0;r<4096&&!(h+r>=e.length);r++)this.vrom[t][r]=255&e.charCodeAt(h+r);h+=4096}for(this.vromTile=new Array(this.vromCount),t=0;t<this.vromCount;t++)for(this.vromTile[t]=new Array(256),r=0;r<256;r++)this.vromTile[t][r]=new JSNES.PPU.Tile;for(a=0;a<this.vromCount;a++)for(t=0;t<4096;t++)p=t>>4,(m=t%16)<8?this.vromTile[a][p].setScanline(m,this.vrom[a][t],this.vrom[a][t+8]):this.vromTile[a][p].setScanline(m-8,this.vrom[a][t-8],this.vrom[a][t]);this.valid=!0}},getMirroringType:function(){return this.fourScreen?this.FOURSCREEN_MIRRORING:0===this.mirroring?this.HORIZONTAL_MIRRORING:this.VERTICAL_MIRRORING},getMapperName:function(){return 0<=this.mapperType&&this.mapperType<this.mapperName.length?this.mapperName[this.mapperType]:"Unknown Mapper, "+this.mapperType},mapperSupported:function(){return void 0!==JSNES.Mappers[this.mapperType]},createMapper:function(){return this.mapperSupported()?new JSNES.Mappers[this.mapperType](this.nes):(this.nes.ui.updateStatus("This ROM uses a mapper not supported by JSNES: "+this.getMapperName()+"("+this.mapperType+")"),null)}};